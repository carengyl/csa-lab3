# Лабораторная работа №3: Эксперимент.
- Николаев Павел Дмитриевич
- Вариант: `asm | acc | harv | hw | instr | struct | stream | mem | pstr | prob2 | cache`
- Упрощенный вариант

## Язык программирования. Assembly
### Расширенная форма Бэкуса-Наура
``` ebnf
program ::= { line }

line ::= label [ comment ] "\n"
       | instr [ comment ] "\n"
       | [ comment ] "\n"

label ::= label_name ":"

instr ::= op0
        | op1 integer
        | op1 char
        | op1 address
        | op2 address
        | op3 label_name

op0 ::= "inc"
      | "dec"
      | "halt"
      | "pop"
      | "push"
      | "ret"
      | "movh"
      | "input"
      | "print"

op1 ::= "load"
      | "add"
      | "sub"
      | "mul"
      | "div"
      | "rem"
      | "cmp"
      
op2 ::= "store"

op3 ::= "jmp"
      | "je"
      | "jne"
      | "jge"
      | "call"
      | "func"

integer ::= [ "-" ] { <any of "0-9"> }-

char ::= '<"a-z A-z">'

address ::= <any of *> { <any of "0-9"> }

label_name ::= <any of "a-z A-Z _"> { <any of "a-z A-Z 0-9 _"> }

comment ::= ";" <any symbols except "\n">
```

### Команды:

#### Адресные команды:
- `add M`: M + acc -> acc
- `sub M`: acc - M -> acc
- `mul M`: acc * M -> acc
- `div M`: acc // M -> acc
- `rem M`: acc % M -> acc
- `cmp M`: установить флаги по результату AC - M
- `store M`: acc -> M (не поддерживает прямую загрузку)

#### Безадресные команды:
- `inc`: acc + 1 -> acc
- `dec`: acc - 1 -> acc
- `halt`: остановить процессор
- `movh`: acc[7:0] -> acc[31:24]

#### Команды ветвления:
- `jmp D`: L -> ip
- `je D`: if Z==1: L -> ip
- `jne`: if Z==0: L -> ip
- `jge`: if N==0: L -> ip

#### Команды подпрограмм:
- `pop`: (sp) -> acc, sp + 1 -> sp
- `push`: sp - 1 -> sp, acc -> (sp) 
- `func`: L -> acc
- `call`: sp - 1 -> sp, IP -> (sp), L -> ip
- `ret`: (sp) -> ip, sp + 1 -> sp

#### Команды ввода-вывода:
- `input`: загрузить токен из буфера ввода в аккумулятор
- `print`: выгрузить токен из аккумулятора в буфер вывода

### Метки
Метки для переходов определяются на отдельных строчках:
``` asm
label: 
    instruction
```

И в другом месте (неважно, до или после определения) сослаться на эту метку:
``` asm
jmp label   ; --> `jmp 123`, где 123 - номер инструкции после объявления метки
```

Транслятор поставит на место использования метки адрес той инструкции, перед которой она определена. (Аналогично для call)

В программе не может быть дублирующихся меток, определенных в разных местах с одним именем.

## Организация памяти
Память устроена следующим образом:
1. Гарвардская архитектура - разделение памяти команд и памяти данных.
2. Память команд: машинное слово - не определено. Реализовано списком словарей, каждый из которых описывает одну инструкцию.
3. Память данных: машинное слово - 4 байта, знаковое. Реализовано списком чисел.
4. Система команд выстроена вокруг аккумулятора (acc) - программисту для взаимодействия доступен только этот регистр. 
5. Для реализации подпрограмм присутствует указатель стека (SP), который указывает на конец памяти данных.

